version: 2

models:
  - name: v_problem
    config:
      tags: ['care_quality_and_program_data']
    description: > 
      The problem list describes all current and historical diagnoses or conditions for a specified patient. Conditions and diagnoses may be entered as part of an assessment of an ongoing condition, or may have been provided as medical history by the patient. All problem list diagnoses must be coded according to appropriate code sets (i.e. International Classification of Diagnoses v9 or v10).  Because problem list entries may be historical or current, and active or inactive, each entry must have definitive dates indicating the onset and resolution (if applicable) of the condition. Although problem list entries contain an optional status flag, for the purposes of calculations, Arcadia Analytics considers a problem active if the resolved date is empty (or until the resolved date for historical analysis).
    data_tests:
      - not_empty:
          meta:
            requirement: [ 'FDR-1849' ]
    columns:
      - name: person_id   
        description: > 
          QDW person ID for the patient. 
      - name: problem_id
        description: >
          QDW problem ID in integer format; an alternate primary key generated by Arcadia.  This value is used in the rpt.event table to tie back to a specific row in this table.  
      - name: site_name
        description: >
          Name of the clinical data source from which this record was obtained.
      - name: originating_encounter_id
        description: >
          QDW encounter ID for the encounter during which the provider first diagnosed the problem or first documented the condition.  
      - name: updated_encounter_id
        description: >
          QDW encounter ID for the encounter during which the provider updated the problem documentation.  This value is populated more often than the originating_encounter_id.
      - name: provider_NPI
        description: >
          National Provider Identifier (NPI) code of the provider who recorded this problem.   NPI codes are maintained by CMS and may represent either an individual provider or a healthcare organization.  Valid NPI codes are 10 digits long with no leading zeroes.  NPI codes do not uniquely identify a given provider row.  The same NPI code may be present on multiple provider rows, for example when the clinical data source uses the NPI code for the organization on rows for providers working in that organization who do not have individual NPI codes.  A given provider could also be active at multiple clinical sites, in which case there would be a multiple provider_ids (one per site) for the same NPI code, since a QDW provider_id is used only on data from a single clinical data source.
      - name: provider_name
        description: >
          Full name of the provider who recorded this problem.   This value is derived by combining the values in proehr_first_name and proehr_last_name (not proehr_middle_name) and formatting them as Lastname, Firstname.  When the provider is an organization rather than an individual, this value may not correctly reflect the name due to this automated formatting. 
      - name: original_id
        description: >
          ID of the problem row in the Staging database, used to tie back to the source system.  This is created by the connector query or direct feed that loads the row from a given source, and is derived from source system column(s) to uniquely identify a row. For a given source, one original ID corresponds to one and only one QDW ID for this entity.  The same original ID value could be found on more than one row if the rows are derived from different sources.
      - name: patient_id
        description: >
          QDW patient ID in integer format for the patient whose problem is recorded.
      - name: problem_status
        description: >
           Status of the condition, indicating whether the patient is still experiencing this condition, e.g. 'Active' or 'Inactive'.
      - name: problem_severity
        description: >
          Severity of the condition being documented, e.g. 'Mild', 'Moderate', 'Severe', 'Fatal'.
      - name: problem_description
        description: >
          Text description of the condition documented in the ICD9_code or ICD10_code.  In most cases, this matches the official description for the code, although different sources may use different descriptions for a given code.
      - name: problem_notes
        description: >
          Free-text notes entered by the provider related to the problem being documented.
      - name: icd9_code
        description: >
          ICD9 diagnosis code for the condition that the provider diagnosed the patient as having.  The value is derived from the value in icd9_code_unscrubbed using scrubbing logic to ensure it matches a valid code in lookup.code. If the value in icd9_code_unscrubbed represents an ICD10 code, autodetect logic will move that value into icd10_code and NULL this column. The format includes a period, if one is required.  ICD9 codes are expected on conditions documented prior to October 2015.
      - name: icd9_code_unscrubbed
        description: >
          ICD9 Diagnosis code for the condition that the provider documented the patient as having, as specified in the clinical data source.  This value is scrubbed into the icd9_code column.
      - name: icd10_code
        description: >
          ICD10 Diagnosis code; the condition that the provider documented the patient as having, scrubbed to ensure it is a valid ICD10 code.  This format typically contains a period in the value.   ICD10 codes are expected on conditions documented from October 2015 to the present.
      - name: icd10_code_unscrubbed
        description: >
          ICD10 Diagnosis code for the condition that the provider documented the patient as having, as specified in the clinical data source.  This value is scrubbed into the icd10_code column.
      - name: onset_date
        description: >
          Date and time when the patient was first diagnosed with the specified condition.  This is the key date column for this entity, and is used to populate the StartDate in the rpt.Event table. Typically the time information is not specified.
      - name: resolved_date
        description: >
          Date and time when the patient ceased to experience this condition, or when the resolution was documented.  If this value is not populated, that is interpreted as meaning that the problem remains active.  But in  clinical data sources, this information is not always documented, so problems may appear as active indefinitely.  This value is used to populate the EndDate in the rpt.Event table. 
      - name: entry_timestamp
        description: >
          Date and time when the row was first inserted into the QDW.  When neither onset_date nor modify_timestamp is populated, this value is used instead to populate the StartDate in the rpt.Event table.
      - name: updated_timestamp
        description: >
          Date and time when the row was last updated in the QDW.
      - name: create_timestamp
        description: >
          Date and time when the record was first inserted into the clinical data source.
      - name: modify_timestamp
        description: >
            Date and time when the record was last updated in the clinical data source.  When onset_date is not populate this is used to populate StartDate in the events table.
      - name: created_by
        description: >
          User who first inserted the row into the source system, as specified by a user ID known to the source system.
      - name: modified_by
        description: >
           User who most recently updated the row in the source system, as specified by a user ID known to the source system.
      - name: delete_ind
        description: >
          Indicates if the record is marked as deleted, either because it was deleted in the clinical data source, or because the connector query changed in a way that makes the record no longer valid.  Values are Y (deleted) and N (not deleted).  If the value is 'Y' then the row should be excluded from all queries.
      - name: orig_site_id
        description: >
          QDW site ID in integer format of the clinical data source from which this record was obtained.
      - name: loaded_from_file
        description: >
          Name of the file from which this particular record was first loaded, usually a CSV file. When Arcadia pulls data from an EHR source via Informatica, we automatically embed the following pieces of information in this file name: date and time of the extract, client and source IDs, and connector query version.  When data partners instead send us direct feeds that are loaded directly into staging (i.e. bypassing prestaging), the file name is created by the data partner and therefore may not contain the same type of information.
      - name: arc_site_id				
        description: >
          Arcadia site ID of the clinical data source from which this record was obtained.
      - name: arc_provider_id				
        description: >
          The provider's Arcadia universal ID.
