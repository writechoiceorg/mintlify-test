version: 2

models:
  - name: v_allergy
    description: > 
      This table contains clinical statements representing whether an allergy or adverse reaction exists or does not exist to a specific agent. The agents may be medications or they may be food items or environmental.  Arcadia Analytics measure logic makes use of drug allergies; other types of allergies are currently informational only.  The agent should be asserted explicitly and defined through a national code set, specifically medication brand names, generic names or NDC. Allergies should have a definitive indication of whether or not an allergy has or has not been resolved.
    config:
      tags: [ 'care_quality_and_program_data' ]
    data_tests:
      - not_empty:
          meta:
            requirement: [ 'FDR-1849' ]
    columns:
    - name: person_id				
      description: >
          QDW person ID for the patient. 
    - name: allergy_id				
      description: >
          QDW allergy ID in integer format; an alternate primary key generated by Arcadia.  This value is used in the rpt.event table to tie back to a specific row in this table.
    - name: encounter_id				
      description: >
          QDW encounter ID for the encounter during which the patient's allergy was documented in integer format.  In data from some clinical data sources, this is typically null.
    - name: provider_NPI				
      description: >
          National Provider Identifier (NPI) code of the provider who documented the allergy.  Is not currently populated but will be populated in a future enhancement.  NPI codes are maintained by CMS and may represent either an individual provider or a healthcare organization.  Valid NPI codes are 10 digits long with no leading zeroes.  NPI codes do not uniquely identify a given provider row.  The same NPI code may be present on multiple provider rows, for example when the clinical data source uses the NPI code for the organization on rows for providers working in that organization who do not have individual NPI codes.  A given provider could also be active at multiple clinical sites, in which case there would be a multiple provider_ids (one per site) for the same NPI code, since a QDW provider_id is used only on data from a single clinical data source.
    - name: provider_name				
      description: >
          Full name of the provider who documented the allergy.  Is not currently populated but will be populated in a future enhancement.  This value is derived by combining the values in proehr_first_name and proehr_last_name (not proehr_middle_name) and formatting them as Lastname, Firstname.  When the provider is an organization rather than an individual, this value may not correctly reflect the name due to this automated formatting. 
    - name: allergy_original_id			
      description: >
          ID of the allergy row in the Staging database, used to tie back to the source system.  This is created by the connector query or direct feed that loads the row from a given source, and is derived from source system column(s) to uniquely identify a row. For a given source, one original ID corresponds to one and only one QDW ID for this entity.  The same original ID value could be found on more than one row if the rows are derived from different sources.
    - name: allergy_NDCid			
      description: >
          NDC code for the drug allergen.  Should be populated for all drug allergies, unless allergy_RxNorm is specified instead.  Generally formatted as 11 numeric characters, which may contain leading zeroes.  For non-drug allergies, should be null.
    - name: allergy_NDCid_unscrubbed				
      description: >
          NDC code for the drug allergen.  Should be populated for all drug allergies, unless allergy_RxNorm is specified instead.  Generally formatted as 11 numeric characters, which may contain leading zeroes.  This is scrubbed into allergy_NDCid.
    - name: allergy_description				
      description: >
          Name of the allergy in free text, e.g. 'Amoxicillin', 'Codeine', 'Egg', or 'Latex'.  Indicates the allergen, i.e. what the patient is allergic to.  May contain the value 'No Known Allergies'.  For drug allergies it should roughly match the description for the drug specified using NDC or RxNorm code.
    - name: allergy_type			
      description: >
          Category of the substance to which the patient has an allergy or intolerance, e.g. 'Drug', 'Food, 'Environment', or 'Other'.  Certain measures look specifically for rows in this table with an allergy_type value of 'Drug'.  This value is derived from the value in allergy_type_unscrubbed.
    - name: allergy_type_unscrubbed					
      description: >
          Category of the substance to which the patient has an allergy or intolerance, as specified in the clinical data source.  This value is scrubbed into the allergy_type column.  
    - name: allergy_start_date			
      description: >
          Date and time recorded for allergy onset.  Typically the time information is not specified.  This is the key date column for this entity, and is used to populate the StartDate in the rpt.Event table.
    - name: allergy_stopped_date			
      description: >
          Date and time as of when the allergy or intolerance ended, if the patient indicates that it has ended.  Typically the time information is not specified.  Null value indicates that the allergy or intolerance is still an ongoing issue.  Is most often null.  This value is used to populate the EndDate in the rpt.Event table.    		
    - name: allergy_entry_timestamp			
      description: >
          Date and time when the row was first inserted into the QDW.
    - name: allergy_updated_timestamp		
      description: >
          Date and time when the row was last updated in the QDW.
    - name: allergy_create_timestamp			
      description: >
          Date and time when the record was first inserted into the clinical data source.  When allergy_start_date is not populated, this value is used instead to populate the StartDate in the rpt.Event table.
    - name: allergy_modify_timestamp			
      description: >
          Date and time when the row was last updated in the clinical data source.
    - name: allergy_delete_ind			
      description: >
          Indicates if the record is marked as deleted, either because it was deleted in the clinical data source, or because the connector query changed in a way that makes the record no longer valid.  Values are Y (deleted) and N (not deleted).  If the value is 'Y' then the row should be excluded from all queries.
    - name: allergy_site_name				
      description: >
          Name of the clinical data source from which this record was obtained.
    - name: allergy_orig_site_id			
      description: >
          QDW site ID in integer format of the clinical data source from which this record was obtained.
    - name: allergy_patient_id			
      description: >
          QDW patient ID in integer format for the patient whose allergy is recorded in integer format.
    - name: allergy_loaded_from_file			
      description: >
          Name of the file from which this particular record was first loaded, usually a CSV file. When Arcadia pulls data from an EHR source via Informatica, we automatically embed the following pieces of information in this file name: date and time of the extract, client and source IDs, and connector query version.  When data partners instead send us direct feeds that are loaded directly into staging (i.e. bypassing prestaging), the file name is created by the data partner and therefore may not contain the same type of information.
    - name: allergy_severity				
      description: >
          Describes severity of allergy, e.g. 'Mild', 'Moderate', 'Severe', or 'Fatal'.
    - name: allergy_reaction				
      description: >
          Describes the patient's reaction to the allergen.  A free-text field that may contain one or more words or phrases such as 'rash', 'hives', or 'anaphylaxis'.
    - name: allergy_RxNorm			
      description: >
          RxNorm concept unique identifier (RXCUI) for the drug allergen.  Usually null, but should be populated for drug allergies where the drug allergen is not specified using an NDC code.  Generally formatted as 1-7 numeric characters with no leading zeroes.  For non-drug allergies, should be null.